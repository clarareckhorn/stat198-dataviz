---
title:  Week 2
subtitle:  Introduction to the Grammar of Graphics
format: stat198slides-revealjs
---

# Learning Goals

-   Understand the theoretical framework of the Grammar of Graphics
-   Break down key components of a graphic: data, aesthetics, geoms, stats, scales, facets, themes
-   Learn how ggplot2 implements this grammar in practice

# Discussion

**Reading:** [The Age That Women Have Babies](https://www.nytimes.com/interactive/2018/08/04/upshot/up-birth-age-gap.html)

Get into groups of 2-3 people and discuss the following questions:

::::: {columns}
::: {.column width="40%"}
![](images/discussion_graph_1980.png)
:::

::: {.column width="40%"}
![](images/discussion_graph_2016.png)
:::
:::::

1.  What is something you like about the way this data is portrayed?
2.  What is something you would change in these visualizations?
3.  What data does the percentages on the vertical axis represent?

# Types of Graphs
...

...

# The Grammar of Graphics

## "The Grammar of Graphics"

From a conceptual perspective, making graphics involves **mapping data** to *geometric objects* and their *visual properties*.

## Why do we need Grammar of Graphics (GG)?

We believe that the GG is a good starting point that gives us a **framework** (mental map) and a **vocabulary** to create graphics.

This grammar allows creation of graphics to be:

-   consistent

-   reusable 

-   modular

## 

Formalized by Leland Wilkinson (1999)

::::: columns
::: column
-   A formal set of rules to create any type of graphics
-   Underlies most modern data visualization software.
-   Implemented as an R package ('ggplot2')
:::

::: {.column .fragment}
![](images/Grammar_of_graphics.png)
:::
:::::

# Key Concepts

. . .

-   **Data**: the data set being visualized (next week!)
-   **Aesthetics (aes)**: how variables map to visual properties (x, y, color, size, etc)
-   **Geometric objects (geoms)**: what kind of mark to draw (points, bars, lines)
-   **Stats**: statistical transformations (e.g. binning for histograms, smoothing lines)
-   **Scales**: how data values are translated into visual values (e.g. color gradients)
-   **Facets**: creating small multiples by splitting data into panels.
-   **Themes**: controlling non-data elements (fonts, backgrounds, gridlines)


# Meet the palmers


```{r}
library(palmerpenguins)
penguins
```

# 

**Question**: In terms of the way they are constructed...

```{r}
#| echo: false
#| fig-width: 16
#| fig-align: center
library(tidyverse)
library(ggplot2)
library(palmerpenguins)

p1 <- penguins |>
  ggplot(aes(x = bill_length_mm)) +
  geom_histogram() +
  theme_bw(base_size = 15) +
  labs(x = "Length of Bill (milimeters)")

p2 <- penguins |>
  ggplot(aes(x = bill_depth_mm)) +
  geom_density() +
  labs(x = "Length of Bill (milimeters)") +
  theme_bw(base_size = 15)

p3 <- penguins |>
  ggplot(aes(x = body_mass_g)) +
  geom_boxplot() +
  labs(x = "Body Mass (grams)")
  theme_bw(base_size = 15)

library(patchwork)

p1 + p2 + p3
```

What do these plots have in common? How do they differ?

{{< countdown "1:20" >}}

## 

**Question**: What do these plots have in common? How do they differ?

```{r}
#| echo: false

p4 <- penguins |>
  ggplot(aes(x = island,
             fill = species)) +
  geom_bar(position = "fill") +
  labs(x = "Islands",
       y = "Count")

p5 <- penguins |>
  ggplot(aes(y = sex)) +
  geom_bar() +
  labs(x = "Sex",
       y = "Count")

p4 + p5
```

{{< countdown "1:20" >}}

## 

**Key idea:**\
These plots use the **same data**, but different **grammars**.

::: columns

::: column
They share:

-   the same dataset (`penguins`)

-   a single mapped variable
:::

::: column
They differ by:

-   geometry (histogram, density, boxplot)

-   statistical transformation

:::

:::
. . .

## Aesthetic Mapping {auto-animate="true"}

. . .

An *aesthetic mapping* links a [variable]{.underline} in the data to a [visual channel]{.underline} that can encode its variation.

. . .

### Channels for ordered variables

![](images/channels_unordered_variables1.png)

::: aside
From "Data Visualization" by Kieran Healy.
:::

## Aesthetic Mapping {auto-animate="true"}

An *aesthetic mapping* links a variable in the data to a visual channel that can encode its variation.

### Channels for unordered variables

![](images/channels_unordered_variables2.png){fig-align="center"}

::: aside
From "Data Visualization" by Kieran Healy.
:::

## Geometry

The *geometry* describes how to translate the observations into marks on the page.

. . .

### Examples

-   Point
-   Line
-   Bar

## Named plots

::: notes
Draw "Scatterplot" and "barchart" along with their description in the g of g.
:::

## Redux 1

```{r}
#| echo: false
#| fig-width: 16
#| fig-align: center
library(tidyverse)
library(palmerpenguins)

p1 <- penguins |>
  ggplot(aes(x = bill_length_mm)) +
  geom_histogram() +
  theme_bw(base_size = 15)

p2 <- penguins |>
  ggplot(aes(x = bill_depth_mm)) +
  geom_density() +
  theme_bw(base_size = 15)

p3 <- penguins |>
  ggplot(aes(x = body_mass_g)) +
  geom_boxplot() +
  theme_bw(base_size = 15)

library(patchwork)

p1 + p2 + p3
```

## Redux 1

```{r}
#| echo: false

p4 <- penguins |>
  ggplot(aes(x = island,
             fill = species)) +
  geom_bar(position = "fill")

p5 <- penguins |>
  ggplot(aes(y = sex)) +
  geom_bar()

p4 + p5
```

## 

**Question**: What are the aesthetic mappings and geometries used here?

```{r}
#| echo: false
#| fig-align: center
penguins |>
  ggplot(aes(x = bill_length_mm,
             y = flipper_length_mm,
             color = species,
             shape = sex)) +
  geom_point() +
  theme_gray(base_size = 18)
```

{{< countdown "1:30" >}}

# ggplot2

##  {auto-animate="true"}

![](images/tidyverse-hex.svg){fig-align="center"}

##  {auto-animate="true"}

::::: columns
::: {.column width="50%"}
![](images/tidyverse-hex.svg)
:::

::: {.column width="50%"}
![](images/dplyr-hex.svg)
:::
:::::

##  {auto-animate="true"}

:::::: columns
::: {.column width="33%"}
![](images/ggplot2-hex.svg)
:::

::: {.column width="33%"}
![](images/tidyverse-hex.svg)
:::

::: {.column width="33%"}
![](images/dplyr-hex.svg)
:::
::::::

## `ggplot2()`

. . .

A plot can be decomposed into three primary elements:

1.  the **data**,
2.  the **aesthetic mapping** of the variables in the data to visual channels, and
3.  the **geometry** used to translate the observations into marks on the plot.

# Code Example

Hereâ€™s an example of code and output using **ggplot2** in R.

```{r}
#| output-location: column-fragment
library(ggplot2)

ggplot(mtcars, aes(x = wt, y = mpg, color = factor(cyl))) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(
    title = "Miles per Gallon vs. Weight",
    color = "Cylinders"
  )
```

## Two Columns {.smaller}

::::: columns
::: column
Explanation

Columns are great for mixing code, plots, and text.\

-   Left and right content\

-   Works well for comparisons\

-   Helps structure visual walkthroughs\
:::

::: {.column .fragment}
Example plot
:::
:::::

# Wrap-Up

## Meet the Palmer Penguins ![](images/penguins-hex.png){width="80"} {.smaller}

```{r}
library(palmerpenguins)
penguins
```

## 

**Question**: In terms of the way they are constructed...

```{r}
#| echo: false
#| fig-width: 16
#| fig-align: center
library(tidyverse)
library(palmerpenguins)

p1 <- penguins |>
  ggplot(aes(x = bill_length_mm)) +
  geom_histogram() +
  theme_bw(base_size = 15)

p2 <- penguins |>
  ggplot(aes(x = bill_depth_mm)) +
  geom_density() +
  theme_bw(base_size = 15)

p3 <- penguins |>
  ggplot(aes(x = body_mass_g)) +
  geom_boxplot() +
  theme_bw(base_size = 15)

library(patchwork)

p1 + p2 + p3
```

What do these plots have in common? How do they differ?

{{< countdown "1:20" >}}

## 

**Question**: What do these plots have in common? How do they differ?

```{r}
#| echo: false

p4 <- penguins |>
  ggplot(aes(x = island,
             fill = species)) +
  geom_bar(position = "fill")

p5 <- penguins |>
  ggplot(aes(y = sex)) +
  geom_bar()

p4 + p5
```

{{< countdown "1:20" >}}

# The Grammar of Graphics

## "The Grammar of Graphics"

Leland Wilkinson (1999)

::::: columns
::: column
-   A grammar to describes all statistical graphics.
-   Underlies most modern data visualization software.
:::

::: {.column .fragment}
![](images/Grammar_of_graphics.png)
:::
:::::

## Aesthetic Mapping {auto-animate="true"}

. . .

An *aesthetic mapping* links a variable in the data to a visual channel that can encode its variation.

. . .

### Channels for ordered variables

![](images/channels_unordered_variables1.png)

## Aesthetic Mapping {auto-animate="true"}

An *aesthetic mapping* links a variable in the data to a visual channel that can encode its variation.

### Channels for unordered variables

![](images/channels_unordered_variables2.png){fig-align="center"}

## Geometry

The *geometry* describes how to translate the observations into marks on the page.

. . .

### Examples

-   Point
-   Line
-   Bar

## Named plots

::: notes
Draw "Scatterplot" and "barchart" along with their description in the g of g.
:::

## Redux 1

```{r}
#| echo: false
#| fig-width: 16
#| fig-align: center
library(tidyverse)
library(palmerpenguins)

p1 <- penguins |>
  ggplot(aes(x = bill_length_mm)) +
  geom_histogram() +
  theme_bw(base_size = 15)

p2 <- penguins |>
  ggplot(aes(x = bill_depth_mm)) +
  geom_density() +
  theme_bw(base_size = 15)

p3 <- penguins |>
  ggplot(aes(x = body_mass_g)) +
  geom_boxplot() +
  theme_bw(base_size = 15)

library(patchwork)

p1 + p2 + p3
```

## Redux 1

```{r}
#| echo: false

p4 <- penguins |>
  ggplot(aes(x = island,
             fill = species)) +
  geom_bar(position = "fill")

p5 <- penguins |>
  ggplot(aes(y = sex)) +
  geom_bar()

p4 + p5
```

## 

**Question**: What are the aesthetic mappings and geometries used here?

```{r}
#| echo: false
#| fig-align: center
penguins |>
  ggplot(aes(x = bill_length_mm,
             y = flipper_length_mm,
             color = species,
             shape = sex)) +
  geom_point() +
  theme_gray(base_size = 18)
```

{{< countdown "1:30" >}}

# ggplot2

##  {auto-animate="true"}

![](images/tidyverse_hex.png){fig-align="center"}

##  {auto-animate="true"}

::::: columns
::: {.column width="50%"}
![](images/tidyverse_hex.png)
:::

::: {.column width="50%"}
![](images/dplyr_hex.png)
:::
:::::

##  {auto-animate="true"}

:::::: columns
::: {.column width="33%"}
![](images/ggplot2_hex.png)
:::

::: {.column width="33%"}
![](images/tidyverse_hex.png)
:::

::: {.column width="33%"}
![](images/dplyr_hex.png)
:::
::::::
